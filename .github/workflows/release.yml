---
on:
  workflow_call:
    inputs:
      enable_draft:
        required: false
        type: boolean
        default: false
      enable_latest:
        required: false
        type: boolean
        default: true
      enable_release_notes:
        required: false
        type: boolean
        default: true
      enable_updates:
        required: false
        type: boolean
        default: true
    # outputs:
    #   next_version:
    #     value: ${{ jobs.release.outputs.next_version }}
  push:
    branches:
      - main
  pull_request:

permissions:
  contents: write

jobs:
  release:
    runs-on: ubuntu-latest
    # outputs:
    #   next_version: ${{ steps.semver.outputs.next }}

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # - name: Get Next Version
      #   id: semver
      #   uses: ietf-tools/semver-action@v1
      #   with:
      #     token: ${{ github.token }}
      #     branch: main

      - name: Create Release
        uses: ncipollo/release-action@v1
        with:
          allowUpdates: ${{ github.event.inputs.enable_updates }}
          commit: main
          # draft: ${{ github.event.inputs.enable_draft }}
          draft: true
          makeLatest: ${{ github.event.inputs.enable_latest }}
          generateReleaseNotes: ${{ github.event.inputs.enable_release_notes }}
          # name: ${{ steps.semver.outputs.next }}
          name: v0.6.4
          # tag: ${{ steps.semver.outputs.next }}
          tag: v0.6.4
          token: ${{ github.token }}

      - name: ll
        run: ls -la

      - name: Heimdallr
        if: github.event_name != 'workflow_call' && github.repository == 'Mosher-Labs/.github'
        uses: ./../.github/workflows/heimdallr.yml
        with:
          # slack_message: "The project <https://github.com/${{ github.repository }}|${{ github.repository }}> just released version <https://github.com/${{ github.repository }}/releases/tag/${{ steps.semver.outputs.next }}|${{ steps.semver.outputs.next }}>."
          slack_message: "The project <https://github.com/${{ github.repository }}|${{ github.repository }}> just released version <https://github.com/${{ github.repository }}/releases/tag/v0.6.4|v0.6.4>."
