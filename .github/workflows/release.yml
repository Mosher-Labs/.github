---
on:
  workflow_call:
    inputs:
      enable_draft:
        required: false
        type: boolean
        default: false
      enable_latest:
        required: false
        type: boolean
        default: true
      enable_release_notes:
        required: false
        type: boolean
        default: true
      enable_updates:
        required: false
        type: boolean
        default: true
  push:
    branches:
      - main
  pull_request:

jobs:
  release:
    permissions:
      contents: write
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Get Next Version
        id: semver
        uses: ietf-tools/semver-action@v1
        with:
          token: ${{ github.token }}
          branch: main

      - name: Determine Draft Mode
        id: draft_mode
        run: if [ ${{ github.event_name }} == 'pull_request' ]; then echo "draft_mode='true'"; else echo "draft_mode='false'"; fi >> "$GITHUB_OUTPUT"

      - name: Create Release
        uses: ncipollo/release-action@v1
        with:
          allowUpdates: ${{ github.event.inputs.enable_updates }}
          commit: main
          draft: ${{ steps.draft_mode.outputs.draft_mode }}
          makeLatest: ${{ github.event.inputs.enable_latest }}
          generateReleaseNotes: ${{ github.event.inputs.enable_release_notes }}
          name: ${{ steps.semver.outputs.next }}
          tag: ${{ steps.semver.outputs.next }}
          token: ${{ github.token }}
